) %>%
left_join(state_lookup, by = "state_upper") %>%
filter(!is.na(state_abb)) %>%
select(state_full, state_abb, total, female, male)
# Ensure all states appear (0 if missing)
all_states <- tibble(state_full = state.name, state_abb = state.abb)
counts_2025 <- all_states %>%
left_join(counts_2025, by = c("state_full", "state_abb")) %>%
mutate(
total  = replace_na(total, 0L),
female = replace_na(female, 0L),
male   = replace_na(male, 0L)
)
# ---- SCALE FOR COLOR (percentile/rank so colors actually vary) ----
scale01 <- function(x) {
if (length(unique(x)) <= 1) return(rep(0, length(x)))
r <- rank(x, ties.method = "average") - 1
r / max(r)
}
counts_2025 <- counts_2025 %>%
mutate(
z_total  = scale01(total),
z_female = scale01(female),
z_male   = scale01(male)
)
# ---- TOOLTIP TEXT (REAL COUNTS) ----
text_total  <- paste0(counts_2025$state_full,
"<br><b>Total arrests:</b> ", counts_2025$total,
"<br>Female: ", counts_2025$female,
"<br>Male: ", counts_2025$male)
text_female <- paste0(counts_2025$state_full,
"<br><b>Female arrests:</b> ", counts_2025$female,
"<br>Total: ", counts_2025$total,
"<br>Male: ", counts_2025$male)
text_male   <- paste0(counts_2025$state_full,
"<br><b>Male arrests:</b> ", counts_2025$male,
"<br>Total: ", counts_2025$total,
"<br>Female: ", counts_2025$female)
# ---- COLOR SCALE: Blue -> Yellow -> Dark Red ----
colorscale <- list(
list(0.00, "blue"),
list(0.50, "yellow"),
list(1.00, "darkred")
)
# ---- MAP (choropleth + state initials overlay + toggle buttons) ----
p <- plot_ly(
data = counts_2025,
type = "choropleth",
locationmode = "USA-states",
locations = ~state_abb,
z = ~z_total,                    # scaled for color
text = text_total,               # real counts in hover
hovertemplate = "%{text}<extra></extra>",
colorscale = colorscale,
zmin = 0, zmax = 1,
colorbar = list(title = "Percentile")
) %>%
add_trace(
type = "scattergeo",
locationmode = "USA-states",
locations = ~state_abb,
text = ~state_abb,
mode = "text",
hoverinfo = "skip",
textfont = list(size = 10)
) %>%
layout(
geo = list(scope = "usa"),
margin = list(l = 0, r = 0, t = 40, b = 0),
title = list(text = "ICE Arrest Counts by State (2025)"),
updatemenus = list(list(
type = "buttons",
direction = "right",
x = 0.02, y = 1.10,
buttons = list(
list(label = "Total",  method = "restyle",
args = list(list(z = list(counts_2025$z_total),
text = list(text_total)), list(1))),
list(label = "Female", method = "restyle",
args = list(list(z = list(counts_2025$z_female),
text = list(text_female)), list(1))),
list(label = "Male",   method = "restyle",
args = list(list(z = list(counts_2025$z_male),
text = list(text_male)), list(1)))
)
))
)
p
options(htmltools.dir.version = FALSE)
library(readxl)
library(dplyr)
library(tidyr)
library(plotly)
# ---- READ + AGGREGATE (2024) ----
df <- read_xlsx("Arrests_Edited_With_Year.xlsx") %>%
filter(`Apprehension Year` == 2024) %>%
mutate(
state_upper = toupper(`Apprehension State`),
Gender = trimws(tolower(Gender))
)
state_lookup <- tibble(
state_upper = toupper(state.name),
state_abb   = state.abb,
state_full  = state.name
)
counts_2024 <- df %>%
group_by(state_upper) %>%
summarise(
total  = n(),
female = sum(Gender == "female", na.rm = TRUE),
male   = sum(Gender == "male",   na.rm = TRUE),
.groups = "drop"
) %>%
left_join(state_lookup, by = "state_upper") %>%
filter(!is.na(state_abb)) %>%
select(state_full, state_abb, total, female, male)
# Ensure all states appear (0 if missing)
all_states <- tibble(state_full = state.name, state_abb = state.abb)
counts_2024 <- all_states %>%
left_join(counts_2024, by = c("state_full", "state_abb")) %>%
mutate(
total  = replace_na(total, 0L),
female = replace_na(female, 0L),
male   = replace_na(male, 0L)
)
# ---- SCALE FOR COLOR (percentile/rank so colors actually vary) ----
scale01 <- function(x) {
if (length(unique(x)) <= 1) return(rep(0, length(x)))
r <- rank(x, ties.method = "average") - 1
r / max(r)
}
counts_2024 <- counts_2024 %>%
mutate(
z_total  = scale01(total),
z_female = scale01(female),
z_male   = scale01(male)
)
# ---- TOOLTIP TEXT (REAL COUNTS) ----
text_total  <- paste0(counts_2024$state_full,
"<br><b>Total arrests:</b> ", counts_2024$total,
"<br>Female: ", counts_2024$female,
"<br>Male: ", counts_2024$male)
text_female <- paste0(counts_2024$state_full,
"<br><b>Female arrests:</b> ", counts_2024$female,
"<br>Total: ", counts_2024$total,
"<br>Male: ", counts_2024$male)
text_male   <- paste0(counts_2024$state_full,
"<br><b>Male arrests:</b> ", counts_2024$male,
"<br>Total: ", counts_2024$total,
"<br>Female: ", counts_2024$female)
# ---- COLOR SCALE: Blue -> Yellow -> Dark Red ----
colorscale <- list(
list(0.00, "blue"),
list(0.50, "yellow"),
list(1.00, "darkred")
)
# ---- MAP (choropleth + state initials overlay + toggle buttons) ----
p <- plot_ly(
data = counts_2024,
type = "choropleth",
locationmode = "USA-states",
locations = ~state_abb,
z = ~z_total,                    # scaled for color
text = text_total,               # real counts in hover
hovertemplate = "%{text}<extra></extra>",
colorscale = colorscale,
zmin = 0, zmax = 1,
colorbar = list(title = "Percentile")
) %>%
add_trace(
type = "scattergeo",
locationmode = "USA-states",
locations = ~state_abb,
text = ~state_abb,
mode = "text",
hoverinfo = "skip",
textfont = list(size = 10)
) %>%
layout(
geo = list(scope = "usa"),
margin = list(l = 0, r = 0, t = 40, b = 0),
title = list(text = "ICE Arrest Counts by State (2025)"),
updatemenus = list(list(
type = "buttons",
direction = "right",
x = 0.02, y = 1.10,
buttons = list(
list(label = "Total",  method = "restyle",
args = list(list(z = list(counts_2025$z_total),
text = list(text_total)), list(1))),
list(label = "Female", method = "restyle",
args = list(list(z = list(counts_2025$z_female),
text = list(text_female)), list(1))),
list(label = "Male",   method = "restyle",
args = list(list(z = list(counts_2025$z_male),
text = list(text_male)), list(1)))
)
))
)
p
options(htmltools.dir.version = FALSE)
library(readxl)
library(dplyr)
library(tidyr)
library(plotly)
# ---- READ + AGGREGATE (2024) ----
df <- read_xlsx("Arrests_Edited_With_Year.xlsx") %>%
filter(`Apprehension Year` == 2024) %>%
mutate(
state_upper = toupper(`Apprehension State`),
Gender = trimws(tolower(Gender))
)
state_lookup <- tibble(
state_upper = toupper(state.name),
state_abb   = state.abb,
state_full  = state.name
)
counts_2024 <- df %>%
group_by(state_upper) %>%
summarise(
total  = n(),
female = sum(Gender == "female", na.rm = TRUE),
male   = sum(Gender == "male",   na.rm = TRUE),
.groups = "drop"
) %>%
left_join(state_lookup, by = "state_upper") %>%
filter(!is.na(state_abb)) %>%
select(state_full, state_abb, total, female, male)
# Ensure all states appear (0 if missing)
all_states <- tibble(state_full = state.name, state_abb = state.abb)
counts_2024 <- all_states %>%
left_join(counts_2024, by = c("state_full", "state_abb")) %>%
mutate(
total  = replace_na(total, 0L),
female = replace_na(female, 0L),
male   = replace_na(male, 0L)
)
# ---- SCALE FOR COLOR (percentile/rank so colors actually vary) ----
scale01 <- function(x) {
if (length(unique(x)) <= 1) return(rep(0, length(x)))
r <- rank(x, ties.method = "average") - 1
r / max(r)
}
counts_2024 <- counts_2024 %>%
mutate(
z_total  = scale01(total),
z_female = scale01(female),
z_male   = scale01(male)
)
# ---- TOOLTIP TEXT (REAL COUNTS) ----
text_total  <- paste0(counts_2024$state_full,
"<br><b>Total arrests:</b> ", counts_2024$total,
"<br>Female: ", counts_2024$female,
"<br>Male: ", counts_2024$male)
text_female <- paste0(counts_2024$state_full,
"<br><b>Female arrests:</b> ", counts_2024$female,
"<br>Total: ", counts_2024$total,
"<br>Male: ", counts_2024$male)
text_male   <- paste0(counts_2024$state_full,
"<br><b>Male arrests:</b> ", counts_2024$male,
"<br>Total: ", counts_2024$total,
"<br>Female: ", counts_2024$female)
# ---- COLOR SCALE: Blue -> Yellow -> Dark Red ----
colorscale <- list(
list(0.00, "blue"),
list(0.50, "yellow"),
list(1.00, "darkred")
)
# ---- MAP (choropleth + state initials overlay + toggle buttons) ----
p <- plot_ly(
data = counts_2024,
type = "choropleth",
locationmode = "USA-states",
locations = ~state_abb,
z = ~z_total,                    # scaled for color
text = text_total,               # real counts in hover
hovertemplate = "%{text}<extra></extra>",
colorscale = colorscale,
zmin = 0, zmax = 1,
colorbar = list(title = "Percentile")
) %>%
add_trace(
type = "scattergeo",
locationmode = "USA-states",
locations = ~state_abb,
text = ~state_abb,
mode = "text",
hoverinfo = "skip",
textfont = list(size = 10)
) %>%
layout(
geo = list(scope = "usa"),
margin = list(l = 0, r = 0, t = 40, b = 0),
title = list(text = "ICE Arrest Counts by State (2025)"),
updatemenus = list(list(
type = "buttons",
direction = "right",
x = 0.02, y = 1.10,
buttons = list(
list(label = "Total",  method = "restyle",
args = list(list(z = list(counts_2024$z_total),
text = list(text_total)), list(1))),
list(label = "Female", method = "restyle",
args = list(list(z = list(counts_2024$z_female),
text = list(text_female)), list(1))),
list(label = "Male",   method = "restyle",
args = list(list(z = list(counts_2024$z_male),
text = list(text_male)), list(1)))
)
))
)
p
library(readxl)
library(dplyr)
library(tidyr)
library(plotly)
# ---- READ + AGGREGATE (2025) ----
df <- read_xlsx("Arrests_Edited_With_Year.xlsx") %>%
filter(`Apprehension Year` == 2025) %>%
mutate(
state_upper = toupper(`Apprehension State`),
Gender = trimws(tolower(Gender))
)
state_lookup <- tibble(
state_upper = toupper(state.name),
state_abb   = state.abb,
state_full  = state.name
)
counts_2025 <- df %>%
group_by(state_upper) %>%
summarise(
total  = n(),
female = sum(Gender == "female", na.rm = TRUE),
male   = sum(Gender == "male",   na.rm = TRUE),
.groups = "drop"
) %>%
left_join(state_lookup, by = "state_upper") %>%
filter(!is.na(state_abb)) %>%
select(state_full, state_abb, total, female, male)
# Ensure all states appear (0 if missing)
all_states <- tibble(state_full = state.name, state_abb = state.abb)
counts_2025 <- all_states %>%
left_join(counts_2025, by = c("state_full", "state_abb")) %>%
mutate(
total  = replace_na(total, 0L),
female = replace_na(female, 0L),
male   = replace_na(male, 0L)
)
# ---- SCALE FOR COLOR (percentile/rank so colors actually vary) ----
scale01 <- function(x) {
if (length(unique(x)) <= 1) return(rep(0, length(x)))
r <- rank(x, ties.method = "average") - 1
r / max(r)
}
counts_2025 <- counts_2025 %>%
mutate(
z_total  = scale01(total),
z_female = scale01(female),
z_male   = scale01(male)
)
# ---- TOOLTIP TEXT (REAL COUNTS) ----
text_total  <- paste0(counts_2025$state_full,
"<br><b>Total arrests:</b> ", counts_2025$total,
"<br>Female: ", counts_2025$female,
"<br>Male: ", counts_2025$male)
text_female <- paste0(counts_2025$state_full,
"<br><b>Female arrests:</b> ", counts_2025$female,
"<br>Total: ", counts_2025$total,
"<br>Male: ", counts_2025$male)
text_male   <- paste0(counts_2025$state_full,
"<br><b>Male arrests:</b> ", counts_2025$male,
"<br>Total: ", counts_2025$total,
"<br>Female: ", counts_2025$female)
# ---- COLOR SCALE: Blue -> Yellow -> Dark Red ----
colorscale <- list(
list(0.00, "blue"),
list(0.50, "yellow"),
list(1.00, "darkred")
)
# ---- MAP (choropleth + state initials overlay + toggle buttons) ----
p <- plot_ly(
data = counts_2025,
type = "choropleth",
locationmode = "USA-states",
locations = ~state_abb,
z = ~z_total,                    # scaled for color
text = text_total,               # real counts in hover
hovertemplate = "%{text}<extra></extra>",
colorscale = colorscale,
zmin = 0, zmax = 1,
colorbar = list(title = "Percentile")
) %>%
add_trace(
type = "scattergeo",
locationmode = "USA-states",
locations = ~state_abb,
text = ~state_abb,
mode = "text",
hoverinfo = "skip",
textfont = list(size = 10)
) %>%
layout(
geo = list(scope = "usa"),
margin = list(l = 0, r = 0, t = 40, b = 0),
title = list(text = "ICE Arrest Counts by State (2025)"),
updatemenus = list(list(
type = "buttons",
direction = "right",
x = 0.02, y = 1.10,
buttons = list(
list(label = "Total",  method = "restyle",
args = list(list(z = list(counts_2025$z_total),
text = list(text_total)), list(1))),
list(label = "Female", method = "restyle",
args = list(list(z = list(counts_2025$z_female),
text = list(text_female)), list(1))),
list(label = "Male",   method = "restyle",
args = list(list(z = list(counts_2025$z_male),
text = list(text_male)), list(1)))
)
))
)
p
options(htmltools.dir.version = FALSE)
library(readxl)
library(dplyr)
library(stringr)
library(plotly)
# --- READ + FILTER 2025 ---
df <- read_xlsx("Arrests_Edited_With_Year.xlsx") %>%
filter(`Apprehension Year` == 2025)
# --- COUNT BY CITIZENSHIP COUNTRY ---
top_n <- 15
tab <- df %>%
mutate(`Citizenship Country` = str_squish(as.character(`Citizenship Country`))) %>%
mutate(`Citizenship Country` = ifelse(is.na(`Citizenship Country`) | `Citizenship Country` == "",
"Unknown", `Citizenship Country`)) %>%
count(`Citizenship Country`, sort = TRUE) %>%
mutate(pct = n / sum(n))
top <- tab %>% slice_head(n = top_n)
other <- tab %>% slice(-(1:top_n)) %>%
summarise(`Citizenship Country` = "Other",
n = sum(n),
pct = sum(pct))
plot_df <- bind_rows(top, other) %>%
arrange(n) %>%
mutate(
hover = paste0("<b>", `Citizenship Country`, "</b>",
"<br>Arrests: ", format(n, big.mark = ","),
"<br>Share: ", sprintf("%.1f%%", 100*pct))
)
# --- INTERACTIVE BAR CHART ---
plot_ly(
data = plot_df,
x = ~n,
y = ~reorder(`Citizenship Country`, n),
type = "bar",
text = ~hover,
hovertemplate = "%{text}<extra></extra>"
) %>%
layout(
title = list(text = "Birth Citizenship of Arrests (2025)"),
xaxis = list(title = "Number of Arrests"),
yaxis = list(title = "", automargin = TRUE),
margin = list(l = 140, r = 20, t = 60, b = 50)
)
options(htmltools.dir.version = FALSE)
library(readxl)
library(dplyr)
library(stringr)
library(plotly)
# --- READ + FILTER 2025 ---
df <- read_xlsx("Arrests_Edited_With_Year.xlsx") %>%
filter(`Apprehension Year` == 2025)
# --- COUNT BY CITIZENSHIP COUNTRY ---
tab <- df %>%
mutate(`Citizenship Country` = str_squish(as.character(`Citizenship Country`))) %>%
mutate(`Citizenship Country` = ifelse(is.na(`Citizenship Country`) | `Citizenship Country` == "",
"Unknown", `Citizenship Country`)) %>%
count(`Citizenship Country`, sort = TRUE) %>%
mutate(pct = n / sum(n))
top_n <- 10
top <- tab %>% slice_head(n = top_n)
other <- tab %>%
slice(-(1:top_n)) %>%
summarise(`Citizenship Country` = "Other",
n = sum(n),
pct = sum(pct))
plot_df <- bind_rows(top, other)
# Force ordering: top 10 by count, then "Other" at bottom
plot_df <- plot_df %>%
mutate(ordering = ifelse(`Citizenship Country` == "Other", -1, n)) %>%
arrange(desc(ordering)) %>%
mutate(`Citizenship Country` = factor(`Citizenship Country`,
levels = rev(`Citizenship Country`)))
# --- INTERACTIVE BAR CHART ---
plot_ly(
data = plot_df,
x = ~n,
y = ~`Citizenship Country`,
type = "bar",
text = ~paste0("<b>", `Citizenship Country`, "</b>",
"<br>Arrests: ", format(n, big.mark = ","),
"<br>Share: ", sprintf("%.1f%%", 100*pct)),
hovertemplate = "%{text}<extra></extra>"
) %>%
layout(
title = list(text = "Top 10 Birth Citizenship of Arrests (2025)"),
xaxis = list(title = "Number of Arrests"),
yaxis = list(title = "", automargin = TRUE),
margin = list(l = 140, r = 20, t = 60, b = 50)
)
